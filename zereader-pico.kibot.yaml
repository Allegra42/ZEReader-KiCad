kibot:
  version: 1

globals:
  # filters:

  # This will undo the 'set_text_variables' task when running locally
  restore_project: true

preflight:
  check_zone_fills: true

  erc:
    enabled: true
    dont_stop: true
  drc:
    enabled: true
    # Set some options to avoid stopping the KiBot run as the design is not finished yet
    dont_stop: true
    ignore_unconnected: false

  fill_zones: true
  update_xml: true

  set_text_variables:
  - name: 'kibot_git-hash'
    command: 'git log -1 --format="%h" $KIBOT_PCB_NAME'

  - name: 'kibot_date'
    command: 'TZ=Europe/Berlin date --iso-8601=minutes'

outputs:
  - name: 'IBoM'
    type: ibom
    dir: BoM

  - name: 'HTML BoM'
    type: bom
    dir: BoM
    options: &bom_options
      format: HTML

  - name: 'Schematic'
    type: pdf_sch_print
    dir: Schematic

  - name: 'Gerber_Files'
    type: gerber
    dir: Gerber
    layers:
      - F.Cu
      - B.Cu
      - F.Paste
      - B.Paste
      - F.SilkS
      - B.SilkS
      - F.Mask
      - B.Mask
      - Edge.Cuts 

  - name: 'Drill'
    type: excellon
    dir: Drill
    options:
      pth_and_npth_single_file: false
      pth_id: '-PTH'
      npth_id: '-NPTH'
      output: "%f%i.drl"

  - name: 'Netlist'
    type: netlist
    dir: Netlist
    options:
      format: ipc
      output: 'netlist.ipc'

  - name: 'Manufacturing Zip'
    type: compress
    dir: Manufacturing
    options:
      format: ZIP
      files:
        - from_output: Gerber
          dest: /
        - from_output: Drill
          dest: /
        - from_output: Netlist
          dest: /

  - name: 'Draw Top View'
    type: pcbdraw
    dir: PCB
    options:
      format: png
      dpi: 300

  - name: 'Draw Bottom View'
    type: pcbdraw
    dir: PCB
    options:
      format: png
      dpi: 300
      bottom: true

  - name: '3D Render Top'
    type: render_3d
    dir: PCB
    options:
      download: true
      view: 'top'
      ray_tracing: true
      height: 1080
      width: 1920

  - name: '3D Render Bottom'
    type: render_3d
    dir: PCB
    options:
      download: true
      view: 'bottom'
      ray_tracing: true
      height: 1080
      width: 1920

  - name: 'KiRi'
    type: kiri
    dir: KiRi
    layers: all


